binance:
  api_key: "${BINANCE_API_KEY}"
  api_secret: "${BINANCE_API_SECRET}"
  proxy:
    http:  "http://127.0.0.1:7890"
    https: "http://127.0.0.1:7890"

coingecko:
  api_key: "${COINGECKO_API_KEY}"  # 可为空或填写公共 API 密钥

mysql:
  host: "localhost"
  port: 3306
  user: "root"
  password: "${MYSQL_PASSWORD}"
  database: "quant_trading"
  charset: "utf8mb4"

data_loader:
  topn: 100             # 获取成交额排名前N的合约
  interval: "1h"       # 主周期K线
  aux_interval: ["5m", "15m", "4h", "1d"]   # 辅助周期K线
  start:  # 起始日期 例如"2024-06-01" 默认获取一年
  end:     # 结束日期
  cache_dir: "data/klines"
  sentiment_cache: "data/sentiment"
  rate_limit_sleep: 0.05   # 每次请求后休息 50ms，1s 20 次 ≪ 2400/min
  excluded_list: ["BUSDT"]

feature_engineering:
  cache_dir: "data/klines"
  merged_dir: "data/merged"
  merged_table_path: "data/merged/merged_table.csv"
  feature_cols_path: "data/merged/feature_cols.txt"
  topn: 100
  mode: train                        # train 或 inference
  scaler_path: scalers/all_features_scaler.json
  btc_symbol: "BTCUSDT"
  eth_symbol: "ETHUSDT"

feature_selector:
  target: target_up   # 也可换 target_up
  top_n: 100             # 每周期保留前 N

models:
  1h:
    up: models/model_1h_up.pkl
    down: models/model_1h_down.pkl
    vol: models/model_1h_vol.pkl
  4h:
    up: models/model_4h_up.pkl
    down: models/model_4h_down.pkl
    vol: models/model_4h_vol.pkl
  d1:
    up: models/model_1d_up.pkl
    down: models/model_1d_down.pkl
    vol: models/model_1d_vol.pkl

database:
  uri: "mysql+pymysql://user:pwd@host:3306/quant_trading"

feature_cols:
  1h: # ≈ 552 k 样本，Feat ≈ 42
    # ─── 价    格 ───
    - pct_chg1_1h
    - pct_chg3_1h
    - pct_chg6_1h
    - pct_chg3_4h        # 上级周期，保留对 mid-term 动量的感知
    - pct_chg6_4h

    # ─── K 线形态 ───
    - bear_streak_1h
    - bull_streak_1h
    - upper_wick_ratio_1h
    - lower_wick_ratio_1h
    - long_upper_shadow_1h
    - long_lower_shadow_1h

    # ─── 技 术 指 标 ───
    - cci_1h
    - cci_delta_1h
    - macd_hist_1h
    - rsi_diff_1h_4h
    - rsi_slope_4h
    - atr_chg_1h
    - atr_pct_ratio_1h_4h
    - bb_width_chg_1h
    - bb_width_ratio_1h_4h

    # ─── 成交量 & 量价 ───
    - vol_ma_ratio_long_1h
    - vol_roc_1h
    - vol_breakout_1h
    - volume_cg_ratio_1h
    - obv_delta_1h
    - vol_profile_density_1h

    # ─── 波动性 ───
    - hv_7d_1h
    - kurtosis_1h
    - skewness_1h

    # ─── 市场相关性 ───
    - btc_correlation_1h_1h
    - eth_correlation_1h_1h

    # ─── 宏观 / 链上 ───
    - cg_market_cap_roc_1h
    - cg_total_volume_roc_1h
    - fg_index_d1
    - donchian_perc_d1
    - cg_market_cap_roc_d1
    - hv_14d_d1
    - ema_diff_d1
    - supertrend_dir_d1

    # ─── 时间哑变量 ───
    - hour_of_day
    - day_of_week

  4h:
    # ─── 价格动量 ───
    - pct_chg1_4h
    - pct_chg3_4h
    - pct_chg6_4h
    - pct_chg12_4h        # 新：半天级别
    - rsi_4h
    - rsi_slope_4h
    - rsi_diff_1h_4h      # 保留唯一 1h→4h 差分
    - macd_hist_4h
    - macd_hist_diff_4h_d1
    - cci_4h
    - cci_delta_4h

    # ─── 波动 & 布林/通道 ───
    - atr_chg_4h
    - atr_pct_ratio_1h_4h     # 跨周期波动
    - bb_width_chg_4h
    - bb_width_ratio_1h_4h
    - kc_width_pct_chg_4h
    - hv_7d_4h
    - hv_30d_4h

    # ─── 形态学 ───
    - upper_wick_ratio_4h
    - lower_wick_ratio_4h
    - long_lower_shadow_4h
    - long_upper_shadow_4h
    - skewness_4h
    - kurtosis_4h

    # ─── 成交量 / 量价 ───
    - vol_ma_ratio_long_4h    # 用 4h 版本
    - vol_roc_4h
    - vol_breakout_4h
    - cg_total_volume_roc_4h
    - vol_ratio_1h_4h         # 唯一留作量占比差分

    # ─── 宏观 & 资金流 ───
    - fg_index_d1
    - cg_market_cap_roc_4h
    - funding_rate_anom_d1

    # ─── 时间哑变量 ───
    - hour_of_day
    - day_of_week

d1:          # ≈ 22 k 样本，Feat ≈ 27
  # ─── 日线动量 ───
  - pct_chg1_d1
  - pct_chg3_d1
  - pct_chg7_d1
  - macd_hist_d1
  - ema_diff_d1
  - rsi_d1
  - rsi_slope_d1

  # ─── 波动 & 通道 ───
  - atr_chg_d1
  - atr_pct_d1
  - kc_width_pct_chg_d1
  - bb_width_chg_d1
  - hv_14d_d1
  - hv_30d_d1

  # ─── 形态 & 分布 ───
  - kurtosis_d1
  - skewness_d1
  - donchian_perc_d1
  - long_lower_shadow_d1
  - upper_wick_ratio_d1

  # ─── 量价 & 资金流 ───
  - vol_ma_ratio_long_d1
  - vol_breakout_d1
  - vol_ratio_4h_d1        # 跨周期量差
  - cg_market_cap_roc_d1
  - cg_total_volume_roc_d1
  - fg_index_d1            # 情绪

  # ─── 跨周期差分（保留 3 个最稳）───
  - rsi_diff_1h_4h
  - atr_pct_ratio_1h_4h
  - vol_ratio_1h_4h


train_settings:
  by_symbol: false
  min_rows: 500
  time_ranges: []
  ts_smote: true
  ts_smote_group_freq: null
  hold_days: 7
  n_trials: 10

# Δ-boost 配置：关键指标与参数
delta_boost:
  core_keys:
    "1h":
      - rsi_1h
      - macd_hist_1h
      - ema_diff_1h
      - atr_pct_1h
      - vol_ma_ratio_1h
      - funding_rate_1h
    "4h":
      - rsi_4h
      - macd_hist_4h
      - ema_diff_4h
    d1:
      - rsi_d1
      - macd_hist_d1
      - ema_diff_d1
  params:
    rsi: [5, 1.0, 0.05]
    macd_hist: [0.002, 100.0, 0.05]
    ema_diff: [0.001, 100.0, 0.03]
    atr_pct: [0.002, 100.0, 0.03]
    vol_ma_ratio: [0.2, 1.0, 0.03]
    funding_rate: [0.0005, 10000, 0.03]


vote_system:
  weight_ai: 2.0
  strong_min: 5
  conf_min: 0.40
  ai_dir_eps: 0.02

# === 调参选项 ===
sentiment_alpha: 0.5
cap_positive_scale: 0.7
volume_guard:
  weak_scale: 0.85
  over_scale: 0.9
  ratio_low: 0.6
  ratio_high: 2.0
  roc_low: -20
  roc_high: 100
ob_threshold:
  min_ob_th: 0.15
  dynamic_factor: 0.08
risk_score_cap: 5.0
exit_lag_bars: 1
quantile: 0.88
vote:
  strong_min: 3
  conf_min: 0.25
oi_protection:
  scale: 0.9
  crowding_threshold: 0.90
veto_level: 0.9
flip_coeff: 0.3
position_coeff:
  range: 0.40
  trend: 0.60
signal_threshold:
  mode: sigmoid      # 可选：sigmoid / double
  base_th: 0.12      # 原 dynamic_th_final 的初始值
  gamma: 0.05        # 过渡宽度
  min_pos: 0.10      # pos_size < 0.10 则 direction = 0
  low_base: 0.10
